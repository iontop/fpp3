---
title: "Chap5_2"
author: "J.H AHN"
date: '2021 12 7 '
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(fpp3)

knitr::opts_chunk$set(echo = TRUE)
```

## 5.2 Some simple forecasting methods

```{r}
# Check data
head(aus_production)

```

```{r}
bricks <- 
    aus_production %>% 
    filter_index("1970 Q1" ~ "2004 Q4") %>% 
    select(Bricks)

bricks

```


`tsibble::filter_index()` 함수를 사용해서 원하는 기간만 손쉽게 추출  


### Mean method  

```{r}
bricks %>% model(MEAN(Bricks))


```


`fable::MEAN()`함수로 평균 모델을 생성  

```{r}
bricks %>% 
    model(MEAN(Bricks)) %>% 
    forecast(h = "5 years") %>% 
    autoplot(bricks, level = NULL) +
    labs(title = "Clay brick production in Australia")


```



### Naive method

```{r}
bricks %>% model(NAIVE(Bricks))

```


`fable::NAIVE()`함수를 이용하여 Naive model 생성  


```{r}
bricks %>% 
    model(NAIVE(Bricks)) %>% 
    forecast(h = "5 years") %>% 
    autoplot(bricks, level = NULL) +
    labs(title = "Clay brick production in Australia")


```

Naive method는 많은 금융, 경제 시계열 데이터와 잘 맞다.  
Naive forecast는 random walk를 따르는 데이터를 예측하는데 최적이다.  
random walk forecast는 `RW()`함수를 사용하여 불러낼 수 있고, `NAIVE()` 대신 사용할 수 있다.  


### Seasonal naive method

계절성을 가진 데이터에 사용할 수 있는 기법  
```{r}
bricks %>% model(SNAIVE(Bricks ~ lag("year")))

```


`lag()`함수는 옵션으로 사용할 수 있고 예제로 사용한 `bricks`는 분기별 데이터 이므로 1년 지연 데이터가 필요하여 "year"를 입력  
어떤 시계열 데이터의 경우는 하나 이상의 계절적 특성이 있기 때문에 lag값을 입력하는 것이 필요  

```{r}
bricks %>% 
    model(SNAIVE(Bricks)) %>% 
    forecast(h = "5 years") %>% 
    autoplot(bricks, level = NULL) +
    labs(title = "Clay brick production in Australia")

```


### Drift method 

naive model의 변형으로 시간에 따라 증가 혹은 감소하는 양의 변화(drift)로 예측하는 기법  
drift는 예측값이 시간에 따라 증가하거나 감소하는 변동량을 말한다.   
랜덤 워크 모델에서는 예측값이 랜덤하게 발생되는 값에 의해 결정되지만 예측값에 영향을 미치는 표류값을 반영할 수도 있다.  

```{r}
bricks %>% model(RW(Bricks ~ drift()))

```


```{r}
bricks %>% 
    model(RW(Bricks ~ drift())) %>% 
    forecast(h = "5 years") %>% 
    autoplot(bricks, level = NULL) +
    labs(title = "Clay brick production in Australia")
```


### Example: Australian quarterly beer production    

아래는 1992년 ~ 2006년간 호주의 분기별 맥주 생산량을 위에서 소개한 기법을 이용하여 나타낸 것이다.  
(실제값과 3.5년간의 예측값을 비교)   

```{r}
# Set training data from 1992 to 2006
train <- aus_production %>%
    filter_index("1992 Q1" ~ "2006 Q4")
# Fit the models
beer_fit <- train %>%
    model(
        Mean = MEAN(Beer),
        `Naïve` = NAIVE(Beer),
        `Seasonal naïve` = SNAIVE(Beer)
    )
# Generate forecasts for 14 quarters
beer_fc <- beer_fit %>% forecast(h = 14)
# Plot forecasts against actual values
beer_fc %>%
    autoplot(train, level = NULL) +
    autolayer(
        filter_index(aus_production, "2007 Q1" ~ .),
        colour = "black"
    ) +
    labs(
        y = "Megalitres",
        title = "Forecasts for quarterly beer production"
    ) +
    guides(colour = guide_legend(title = "Forecast"))


```


### Example: Google’s daily closing stock price  

계절성이 없는 주가와 같은 데이터는 아래와 같이 예측을 할 수 있음.  
아래는 구글의 2015년 주가 데이터이고 1달간의 예측을 수행 한 것임.   
주가가 매일 측정되는 것이 아니기 때문에 사전에 Calendar day가 아닌 Trading day로 인덱스를 변경하였음.  

```{r}
# Re-index based on trading days
google_stock <- gafa_stock %>%
    filter(Symbol == "GOOG", year(Date) >= 2015) %>%
    mutate(day = row_number()) %>%
    update_tsibble(index = day, regular = TRUE)
# Filter the year of interest
google_2015 <- google_stock %>% filter(year(Date) == 2015)
# Fit the models
google_fit <- google_2015 %>%
    model(
        Mean = MEAN(Close),
        `Naïve` = NAIVE(Close),
        Drift = NAIVE(Close ~ drift())
    )
# Produce forecasts for the trading days in January 2016
google_jan_2016 <- google_stock %>%
    filter(yearmonth(Date) == yearmonth("2016 Jan"))
google_fc <- google_fit %>%
    forecast(new_data = google_jan_2016)
# Plot the forecasts
google_fc %>%
    autoplot(google_2015, level = NULL) +
    autolayer(google_jan_2016, Close, colour = "black") +
    labs(y = "$US",
         title = "Google daily closing stock prices",
         subtitle = "(Jan 2015 - Jan 2016)") +
    guides(colour = guide_legend(title = "Forecast"))

```



